<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web to APK + Kevel Showcase</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        /* --- Core Variables --- */
        :root {
            --bg-color: #0a0a0a;
            --surface-color: #171717;
            --border-color: #262626;
            --text-primary: #e5e5e5;
            --text-secondary: #a3a3a3;
            --accent-color: #525252;
            --accent-hover: #737373;
            --success-color: #10b981;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: var(--font-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 20px 80px 20px; /* Padding for sticky footer */
        }

        /* --- Main App Container --- */
        .container {
            width: 100%;
            max-width: 480px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        h1 { font-weight: 300; font-size: 1.5rem; text-align: center; margin: 0 0 0.5rem 0; }
        p.subtitle { text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 2rem; }

        /* --- Form Elements --- */
        .group { margin-bottom: 1.25rem; }
        label { display: block; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-secondary); margin-bottom: 0.5rem; }
        input[type="text"] {
            width: 100%; background: var(--bg-color); border: 1px solid var(--border-color);
            color: var(--text-primary); padding: 12px 16px; border-radius: 6px; font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus { border-color: var(--text-secondary); }

        .file-drop-area {
            border: 1px dashed var(--border-color); border-radius: 6px; padding: 20px;
            text-align: center; cursor: pointer; position: relative; background: var(--bg-color);
            transition: 0.2s;
        }
        .file-drop-area:hover { border-color: var(--text-secondary); background: #111; }
        .file-msg { font-size: 0.85rem; color: var(--text-secondary); }
        input[type="file"] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        button {
            width: 100%; background: var(--accent-color); color: white; border: none;
            padding: 14px; border-radius: 6px; font-size: 0.9rem; font-weight: 500;
            cursor: pointer; transition: 0.2s; margin-top: 10px;
        }
        button:hover { background: var(--accent-hover); }
        button:disabled { opacity: 0.5; cursor: wait; }

        #status { margin-top: 1rem; font-size: 0.8rem; text-align: center; color: var(--text-secondary); min-height: 20px; }
        .icon-preview { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; display: none; margin: 0 auto 10px auto; border: 1px solid var(--border-color); }

        /* --- KEVEL AD STYLES (DEMO) --- */
        
        /* General Ad Label */
        .ad-badge {
            position: absolute; top: 4px; right: 4px;
            background: rgba(0,0,0,0.6); color: #fff; font-size: 9px;
            padding: 2px 4px; border-radius: 2px; text-transform: uppercase;
            pointer-events: none;
        }

        /* 1. NATIVE AD STYLE */
        .native-ad {
            border: 1px solid #333;
            background: #111;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            margin-bottom: 20px;
            cursor: pointer;
            transition: 0.2s;
        }
        .native-ad:hover { border-color: #555; }
        .native-img { width: 50px; height: 50px; background: #333; border-radius: 6px; object-fit: cover; }
        .native-content h4 { margin: 0 0 4px 0; font-size: 14px; color: #fff; }
        .native-content p { margin: 0; font-size: 12px; color: #888; }

        /* 2. STICKY FOOTER STYLE */
        #ad-slot-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: var(--surface-color); border-top: 1px solid var(--border-color);
            z-index: 100; display: flex; justify-content: center; align-items: center;
        }

        /* 3. INTERSTITIAL / POPUP OVERLAY */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 999;
            display: none; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .interstitial-card {
            width: 90%; max-width: 320px; height: 480px;
            background: #fff; position: relative;
            display: flex; flex-direction: column;
            border-radius: 8px; overflow: hidden;
        }
        .close-ad {
            position: absolute; top: 10px; right: 10px;
            background: rgba(0,0,0,0.5); color: white;
            width: 30px; height: 30px; border-radius: 50%;
            text-align: center; line-height: 30px; cursor: pointer; z-index: 10;
        }

        /* Debug Console */
        .debug-console {
            width: 100%; max-width: 480px; background: #000; color: #0f0;
            font-family: monospace; font-size: 10px; padding: 10px;
            border-radius: 6px; margin-top: 20px; height: 120px; overflow-y: auto;
            border: 1px solid #333;
        }
        .debug-entry { margin-bottom: 4px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        .debug-entry span { color: #888; margin-right: 5px; }
        .debug-imp { color: #f59e0b; } /* Yellow for impression */
        .debug-click { color: #10b981; } /* Green for click */
    </style>
</head>
<body>

    <div class="container">
        <h1>Web to Android</h1>
        <p class="subtitle">Kevel Ad Integration Demo</p>

        <div id="ad-slot-native"></div>

        <div class="group">
            <label>Application Name</label>
            <input type="text" id="appName" placeholder="Zen Notes">
        </div>

        <div class="group">
            <label>Package ID</label>
            <input type="text" id="packageId" placeholder="com.harsha.app">
        </div>

        <div class="group">
            <label>App Icon</label>
            <div class="file-drop-area" id="iconDrop">
                <img id="iconPreview" class="icon-preview" alt="Icon Preview">
                <span class="file-msg" id="iconMsg">Click to upload icon</span>
                <input type="file" id="iconFile" accept="image/png, image/jpeg, image/jpg">
            </div>
        </div>

        <div class="group">
            <label>Source Code (index.html)</label>
            <div class="file-drop-area">
                <span class="file-msg" id="htmlMsg">Click to upload index.html</span>
                <input type="file" id="htmlFile" accept=".html">
            </div>
        </div>

        <button id="generateBtn" onclick="generateProjectWithAd()">GENERATE PROJECT ZIP</button>
        
        <button onclick="showRewardedAd()" style="background: transparent; border: 1px dashed #333; margin-top: 15px; color: #666;">
            ▶ Watch Ad for Premium Features (Demo)
        </button>

        <div id="status"></div>
    </div>

    <div class="debug-console" id="debugConsole">
        <div class="debug-entry"><span>System:</span> Kevel Tracking SDK Initialized...</div>
    </div>

    <footer>Made with ❤️ Harsha Varthan E P</footer>

    <div id="ad-slot-footer"></div>

    <div id="interstitial-overlay" class="overlay">
        </div>

    <script>
        /* =========================================
           1. KEVEL AD SERVER MOCK SDK (Advanced)
           ========================================= */

        const MockKevelSDK = {
            
            // Mock Data for different formats
            adInventory: {
                native: {
                    id: 101,
                    impUrl: "https://e-1234.adzerk.net/i.gif?native",
                    clkUrl: "https://e-1234.adzerk.net/r?native",
                    content: `
                        <div class="native-ad">
                            <div class="ad-badge">Sponsored</div>
                            <img src="https://via.placeholder.com/100/3b82f6/ffffff?text=Icon" class="native-img">
                            <div class="native-content">
                                <h4>IconMaker Pro</h4>
                                <p>Create professional app icons in seconds using AI.</p>
                            </div>
                        </div>`
                },
                footer: {
                    id: 102,
                    impUrl: "https://e-1234.adzerk.net/i.gif?footer",
                    clkUrl: "https://e-1234.adzerk.net/r?footer",
                    content: `
                        <div style="width:320px; height:50px; background:#1e40af; display:flex; align-items:center; justify-content:space-between; padding:0 15px; color:#fff; position:relative; overflow:hidden;">
                            <div class="ad-badge" style="background:rgba(255,255,255,0.2);">Ad</div>
                            <span style="font-weight:bold;">ZOHO CRM</span>
                            <span style="font-size:12px;">Automate your sales.</span>
                            <span style="font-size:18px;">&rarr;</span>
                        </div>`
                },
                interstitial: {
                    id: 103,
                    impUrl: "https://e-1234.adzerk.net/i.gif?interstitial",
                    clkUrl: "https://e-1234.adzerk.net/r?interstitial",
                    content: `
                        <div class="interstitial-card">
                            <div class="close-ad" onclick="closeInterstitial()">×</div>
                            <div style="height:60%; background: #4f46e5; display:flex; align-items:center; justify-content:center; color:white; font-size:30px; font-weight:bold;">
                                CLOUD HOSTING
                            </div>
                            <div style="height:40%; padding:20px; text-align:center; color:#333;">
                                <h3>50% Off First Month</h3>
                                <p style="font-size:14px; color:#666;">Deploy your Web APKs instantly.</p>
                                <button style="width:100%; background:#4f46e5; color:white; padding:10px; border:none; border-radius:4px; margin-top:10px;">Claim Offer</button>
                            </div>
                            <div class="ad-badge" style="top:auto; bottom:4px; right:4px; color:#333; background:#eee;">Ads by Kevel</div>
                        </div>`
                },
                rewarded: {
                    id: 104,
                    impUrl: "https://e-1234.adzerk.net/i.gif?rewarded",
                    clkUrl: "https://e-1234.adzerk.net/r?rewarded",
                    content: `
                        <div class="interstitial-card" style="background:#000; color:#fff;">
                            <div style="height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                                <h2 style="color:#10b981;">WATCHING AD...</h2>
                                <div style="width:200px; height:4px; background:#333; margin:20px 0; border-radius:2px;">
                                    <div id="reward-progress" style="width:0%; height:100%; background:#10b981; transition: width 3s linear;"></div>
                                </div>
                                <p>Reward granted in 3s</p>
                            </div>
                        </div>`
                }
            },

            getDecision: async (type) => {
                // Simulate Request Latency
                await new Promise(r => setTimeout(r, 400)); 
                return MockKevelSDK.adInventory[type];
            },

            trackImpression: (type, url) => {
                logDebug(type.toUpperCase(), `Impression tracked: ${url}`);
            },

            trackClick: (type, url) => {
                logDebug(type.toUpperCase(), `Click tracked: ${url}`);
            }
        };


        /* =========================================
           2. AD LOGIC & CONTROLLERS
           ========================================= */

        // Init Static Ads (Native & Footer)
        async function loadStaticAds() {
            // 1. Load Native Ad
            const nativeData = await MockKevelSDK.getDecision('native');
            const nativeSlot = document.getElementById('ad-slot-native');
            nativeSlot.innerHTML = nativeData.content;
            
            // Tracking
            MockKevelSDK.trackImpression('native', nativeData.impUrl);
            nativeSlot.onclick = () => MockKevelSDK.trackClick('native', nativeData.clkUrl);

            // 2. Load Footer Ad
            const footerData = await MockKevelSDK.getDecision('footer');
            const footerSlot = document.getElementById('ad-slot-footer');
            footerSlot.innerHTML = footerData.content;

            // Tracking
            MockKevelSDK.trackImpression('footer', footerData.impUrl);
            footerSlot.onclick = () => MockKevelSDK.trackClick('footer', footerData.clkUrl);
        }

        // Logic for Interstitial (Popup)
        async function generateProjectWithAd() {
            // Check file first
            const htmlInput = document.getElementById('htmlFile');
            const status = document.getElementById('status');
            if (!htmlInput.files.length) {
                status.textContent = "⚠ Please upload an index.html file.";
                status.style.color = "#ef4444";
                return;
            }

            // 1. Show Loading State
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = "LOADING AD...";

            // 2. Fetch & Show Interstitial
            const adData = await MockKevelSDK.getDecision('interstitial');
            const overlay = document.getElementById('interstitial-overlay');
            overlay.innerHTML = adData.content;
            overlay.style.display = 'flex';

            // Tracking
            MockKevelSDK.trackImpression('interstitial', adData.impUrl);
            
            // Allow closing logic
            window.currentInterstitialClickUrl = adData.clkUrl;
        }

        function closeInterstitial() {
            // Close Ad
            document.getElementById('interstitial-overlay').style.display = 'none';
            
            // Resume App Logic
            const btn = document.getElementById('generateBtn');
            btn.textContent = "PROCESSING...";
            generateProject(); // Call the actual APK builder function
        }

        // Logic for Rewarded Video
        async function showRewardedAd() {
            const adData = await MockKevelSDK.getDecision('rewarded');
            const overlay = document.getElementById('interstitial-overlay');
            overlay.innerHTML = adData.content;
            overlay.style.display = 'flex';
            
            MockKevelSDK.trackImpression('rewarded', adData.impUrl);

            // Simulate Video Play
            setTimeout(() => {
                document.getElementById('reward-progress').style.width = "100%";
            }, 100);

            setTimeout(() => {
                overlay.style.display = 'none';
                alert("Reward Granted! Premium features unlocked (Demo).");
                MockKevelSDK.trackClick('rewarded', adData.clkUrl + "?type=complete");
            }, 3500);
        }

        function logDebug(type, msg) {
            const consoleEl = document.getElementById('debugConsole');
            const entry = document.createElement('div');
            entry.className = 'debug-entry';
            
            const typeColor = type === 'IMPRESSION' ? 'debug-imp' : 'debug-click';
            
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `<span>${time}</span> <b class="${typeColor}">[${type}]</b> ${msg}`;
            consoleEl.appendChild(entry);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        // Load static ads on startup
        window.addEventListener('DOMContentLoaded', loadStaticAds);


        /* =========================================
           3. CORE APK BUILDER LOGIC (Unchanged)
           ========================================= */

        document.getElementById('htmlFile').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name;
            document.getElementById('htmlMsg').textContent = fileName || "Click to upload index.html";
            document.getElementById('htmlMsg').style.color = fileName ? "var(--text-primary)" : "var(--text-secondary)";
        });

        document.getElementById('iconFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('iconPreview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        async function generateProject() {
            const appName = document.getElementById('appName').value.trim() || "MyWebViewApp";
            const packageId = document.getElementById('packageId').value.trim() || "com.example.webview";
            const htmlInput = document.getElementById('htmlFile');
            const iconInput = document.getElementById('iconFile');
            const btn = document.getElementById('generateBtn');
            const status = document.getElementById('status');

            status.textContent = "Building Android structure...";

            try {
                const htmlFile = htmlInput.files[0];
                const htmlContent = await htmlFile.text();
                const zip = new JSZip();

                let iconData = null;
                if (iconInput.files.length) {
                    iconData = await processIcon(iconInput.files[0]);
                } else {
                    iconData = await generateDefaultIcon(appName.charAt(0).toUpperCase());
                }
                
                // Gradle Files
                zip.file("build.gradle", getRootGradle());
                zip.file("settings.gradle", `include ':app'\nrootProject.name = "${appName}"`);
                zip.file("gradle.properties", "android.useAndroidX=true\nandroid.enableJetifier=true");

                // App Module
                const app = zip.folder("app");
                app.file("build.gradle", getAppGradle(packageId));

                // Manifest
                const main = app.folder("src").folder("main");
                main.file("AndroidManifest.xml", getManifest(appName, packageId));

                // Java Code
                const packagePath = packageId.replace(/\./g, "/");
                const javaFolder = main.folder("java").folder(packagePath);
                javaFolder.file("MainActivity.java", getJavaCode(packageId));

                // Resources
                const res = main.folder("res");
                res.folder("layout").file("activity_main.xml", getLayoutXml());
                res.folder("values").file("strings.xml", `<resources><string name="app_name">${appName}</string></resources>`);
                res.folder("values").file("themes.xml", getThemeXml());

                // Icons
                const densities = ['mipmap-hdpi', 'mipmap-mdpi', 'mipmap-xhdpi', 'mipmap-xxhdpi', 'mipmap-xxxhdpi'];
                densities.forEach(d => {
                    res.folder(d).file("ic_launcher.png", iconData.split(',')[1], {base64: true});
                    res.folder(d).file("ic_launcher_round.png", iconData.split(',')[1], {base64: true});
                });

                // Assets
                const assets = main.folder("assets");
                assets.file("index.html", htmlContent);

                const content = await zip.generateAsync({type:"blob"});
                saveAs(content, `${appName.replace(/\s+/g, '_')}_Android_Project.zip`);

                status.textContent = "Download Started!";
                status.style.color = "var(--success-color)";
                btn.textContent = "GENERATE PROJECT ZIP";
                btn.disabled = false;

            } catch (err) {
                console.error(err);
                status.textContent = "Error: " + err.message;
                btn.disabled = false;
            }
        }

        // --- Helper Functions ---
        function processIcon(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = 512; canvas.height = 512;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, 512, 512);
                        resolve(canvas.toDataURL('image/png'));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function generateDefaultIcon(letter) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                canvas.width = 512; canvas.height = 512;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = "#171717"; ctx.fillRect(0, 0, 512, 512);
                ctx.fillStyle = "#e5e5e5"; ctx.font = "bold 250px sans-serif";
                ctx.textAlign = "center"; ctx.textBaseline = "middle";
                ctx.fillText(letter, 256, 256);
                resolve(canvas.toDataURL('image/png'));
            });
        }

        // --- Templates ---
        function getRootGradle() { return `buildscript { repositories { google(); mavenCentral() } dependencies { classpath "com.android.tools.build:gradle:8.0.0" } } task clean(type: Delete) { delete rootProject.buildDir }`; }
        function getAppGradle(pkg) { return `plugins { id 'com.android.application' } android { namespace '${pkg}'; compileSdk 33; defaultConfig { applicationId "${pkg}"; minSdk 24; targetSdk 33; versionCode 1; versionName "1.0" } buildTypes { release { minifyEnabled false; proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro' } } } dependencies { implementation 'androidx.appcompat:appcompat:1.6.1' }`; }
        function getManifest(name, pkg) { return `<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.INTERNET" />
    <application android:allowBackup="true" android:icon="@mipmap/ic_launcher" android:label="${name}" android:roundIcon="@mipmap/ic_launcher_round" android:theme="@style/Theme.Stealth">
        <activity android:name=".MainActivity" android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>`; }
        function getJavaCode(pkg) { return `package ${pkg};
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;
public class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        WebView myWebView = findViewById(R.id.webview);
        WebSettings webSettings = myWebView.getSettings();
        webSettings.setJavaScriptEnabled(true);
        webSettings.setDomStorageEnabled(true);
        myWebView.loadUrl("file:///android_asset/index.html");
        myWebView.setWebViewClient(new WebViewClient());
    }
    @Override
    public void onBackPressed() {
        WebView myWebView = findViewById(R.id.webview);
        if (myWebView.canGoBack()) { myWebView.goBack(); } else { super.onBackPressed(); }
    }
}`; }
        function getLayoutXml() { return `<?xml version="1.0" encoding="utf-8"?><androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent"><WebView android:id="@+id/webview" android:layout_width="match_parent" android:layout_height="match_parent" /></androidx.constraintlayout.widget.ConstraintLayout>`; }
        function getThemeXml() { return `<resources><style name="Theme.Stealth" parent="Theme.AppCompat.NoActionBar"><item name="colorPrimary">#0a0a0a</item><item name="colorPrimaryDark">#000000</item><item name="colorAccent">#525252</item></style></resources>`; }
    </script>
</body>
</html>
